<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì‚¬ìš©ì ë°ì´í„° ë¶„ì„ ëŒ€ì‹œë³´ë“œ</title>
    <!-- Vue.js and Chart.js CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- SheetJS (XLSX) CDN for Excel Export -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

    <style>
      /* Google Fonts for better typography */
      @import url("https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap");

      :root {
        --primary-color: #42b883;
        --secondary-color: #35495e;
        --background-color: #f4f7f9;
        --container-bg-color: #ffffff;
        --text-color: #333;
        --light-gray-color: #e0e0e0;
        --shadow-color: rgba(0, 0, 0, 0.1);
        --border-radius: 12px;
      }

      body {
        font-family: "Noto Sans KR", sans-serif;
        background-color: var(--background-color);
        color: var(--text-color);
        margin: 0;
        padding: 20px;
        display: flex;
        justify-content: center;
      }

      #app {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 24px;
      }

      h1 {
        color: var(--secondary-color);
        font-weight: 700;
        text-align: center;
      }

      h2,
      h3 {
        color: var(--secondary-color);
        margin-top: 0;
        font-weight: 700;
      }

      /* --- Common Container Style --- */
      .dashboard-container {
        background-color: var(--container-bg-color);
        padding: 24px;
        border-radius: var(--border-radius);
        box-shadow: 0 4px 12px var(--shadow-color);
        width: 100%;
        max-width: 800px;
        max-height: 400px;
        display: flex;
        flex-direction: column;
        box-sizing: border-box;
      }

      /* --- File Input Container --- */
      .file-input-container {
        text-align: center;
        max-height: none; /* This container doesn't need a fixed height */
      }

      .upload-btn {
        background-color: var(--primary-color);
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 500;
        transition: background-color 0.3s ease;
      }
      .upload-btn:hover {
        background-color: #36a574;
      }
      .upload-btn input[type="file"] {
        display: none;
      }
      .file-info {
        margin-top: 12px;
        font-size: 14px;
        color: #666;
      }

      /* --- Main Content Area --- */
      .main-content-area {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 24px;
      }

      /* --- Chart Container --- */
      .chart-container {
        position: relative;
      }

      /* --- Table Container --- */
      .table-scroll-wrapper {
        overflow-y: auto; /* Makes table scrollable within the container */
      }

      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
      }
      th,
      td {
        padding: 12px 16px;
        text-align: left;
        border-bottom: 1px solid var(--light-gray-color);
      }
      th {
        background-color: #f9fafb;
        font-weight: 500;
        color: var(--secondary-color);
        position: sticky;
        top: 0;
      }
      tbody tr {
        cursor: pointer;
        transition: background-color 0.2s ease;
      }
      tbody tr:hover {
        background-color: #f0f0f0;
      }
      tbody tr.selected {
        background-color: #e0f2f1;
      }

      /* --- User Detail Container --- */
      .user-detail-container {
        justify-content: center;
      }

      .user-detail-scroll-wrapper {
        overflow-y: auto;
      }

      .user-detail-placeholder {
        text-align: center;
        color: #888;
      }
      .user-detail-content .detail-item {
        margin-bottom: 12px;
        font-size: 16px;
      }
      .user-detail-content .detail-item strong {
        color: var(--secondary-color);
        display: inline-block;
        width: 100px;
      }
      .user-detail-content .introduction {
        margin-top: 16px;
        padding: 12px;
        background-color: #f8f9fa;
        border-radius: 8px;
        white-space: pre-wrap;
        line-height: 1.6;
      }

      /* --- Export Container --- */
      .export-container {
        max-height: none;
        text-align: center;
      }
      .export-btn {
        background-color: var(--secondary-color);
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 500;
        transition: background-color 0.3s ease;
        margin-top: 16px;
      }
      .export-btn:hover {
        background-color: #2c3e50;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <header>
        <h1>ì‚¬ìš©ì ë°ì´í„° ë¶„ì„ ëŒ€ì‹œë³´ë“œ</h1>
      </header>

      <!-- 2.1. íŒŒì¼ ì…ë ¥(File Input) container -->
      <section class="dashboard-container file-input-container">
        <h2>ë°ì´í„° ì—…ë¡œë“œ</h2>
        <p>ë¶„ì„í•  ì‚¬ìš©ì ë°ì´í„°ê°€ ë‹´ê¸´ PDF íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.</p>
        <label class="upload-btn">
          íŒŒì¼ ì²¨ë¶€
          <input type="file" @change="handleFileUpload" accept=".pdf" />
        </label>
        <div class="file-info" v-if="fileName">
          {{ fileName }} íŒŒì¼ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.
        </div>
      </section>

      <!-- ë°ì´í„°ê°€ ë¡œë“œëœ í›„ í‘œì‹œë˜ëŠ” ì˜ì—­ -->
      <main v-if="users.length > 0" class="main-content-area">
        <!-- 2.2.1. ë“±ê¸‰ë³„ ì¸ì› í˜„í™© (ë§‰ëŒ€ ì°¨íŠ¸) container -->
        <section class="dashboard-container chart-container">
          <h3>ë“±ê¸‰ë³„ ì¸ì› í˜„í™©</h3>
          <canvas id="gradeChart"></canvas>
        </section>

        <!-- 2.2.2. ì „ì²´ ìœ ì € ì •ë³´ (í…Œì´ë¸”) container -->
        <section class="dashboard-container table-container">
          <h3>ì „ì²´ ìœ ì € ì •ë³´ ({{ users.length }}ëª…)</h3>
          <div class="table-scroll-wrapper">
            <table>
              <thead>
                <tr>
                  <th>ì´ë¦„</th>
                  <th>ë“±ê¸‰</th>
                  <th>ìµœì¢… ì ‘ì†ì¼</th>
                  <th>ìµœì¢… ì°¸ì—¬ì¼</th>
                </tr>
              </thead>
              <tbody>
                <tr
                  v-for="user in usersWithGrades"
                  :key="user.name"
                  @click="selectUser(user)"
                  :class="{ selected: selectedUser && selectedUser.name === user.name }"
                >
                  <td>{{ user.name }}</td>
                  <td>{{ user.grade.icon }} {{ user.grade.name }}</td>
                  <td>{{ user.lastAccessDate }}</td>
                  <td>{{ user.lastParticipationDate }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <!-- 2.2.4. ìœ ì € ìƒì„¸ë³´ê¸° container -->
        <section class="dashboard-container user-detail-container">
          <h3>ìœ ì € ìƒì„¸ë³´ê¸°</h3>
          <div class="user-detail-scroll-wrapper">
            <div v-if="selectedUser" class="user-detail-content">
              <div class="detail-item">
                <strong>ì´ë¦„:</strong> {{ selectedUser.name }}
              </div>
              <div class="detail-item">
                <strong>ë“±ê¸‰:</strong> {{ selectedUser.grade.icon }} {{
                selectedUser.grade.name }}
              </div>
              <div class="detail-item">
                <strong>ìµœì¢… ì ‘ì†ì¼:</strong> {{ selectedUser.lastAccessDate }}
              </div>
              <div class="detail-item">
                <strong>ìµœì¢… ì°¸ì—¬ì¼:</strong> {{
                selectedUser.lastParticipationDate }}
              </div>
              <div class="detail-item">
                <strong>ìê¸°ì†Œê°œ:</strong>
                <div class="introduction">{{ selectedUser.introduction }}</div>
              </div>
            </div>
            <div v-else class="user-detail-placeholder">
              <p>í…Œì´ë¸”ì—ì„œ ì‚¬ìš©ìë¥¼ ì„ íƒí•˜ë©´ ìƒì„¸ ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
          </div>
        </section>

        <!-- 2.2.5. export ë²„íŠ¼ -->
        <section class="dashboard-container export-container">
          <h3>ë°ì´í„° ë‚´ë³´ë‚´ê¸°</h3>
          <p>í•´ë‹¹ ì •ë³´ë¥¼ ë‹¤ìš´ë¡œë“œ ë°›ìœ¼ì„¸ìš”</p>
          <button @click="exportToExcel" class="export-btn">
            ì—‘ì…€ ë¦¬í¬íŠ¸ ì €ì¥
          </button>
        </section>
      </main>
    </div>

    <script>
      const { createApp, ref, computed, watch, nextTick } = Vue;

      createApp({
        setup() {
          // --- DATA ---
          const users = ref([]);
          const fileName = ref("");
          const selectedUser = ref(null);
          let chartInstance = null;

          const grades = {
            newbie: { name: "ì‹ ì…", icon: "ğŸ¥" },
            steady: { name: "ê¾¸ì¤€", icon: "ğŸ“ˆ" },
            enthusiast: { name: "ì—´í˜ˆ", icon: "ğŸ”¥" },
            inactive: { name: "ë¯¸ì°¸ì—¬", icon: "ğŸ‘»" },
          };

          // --- COMPUTED PROPERTIES ---
          const getUserGrade = (participationCount) => {
            if (participationCount === 0) return grades.inactive;
            if (participationCount <= 3) return grades.newbie;
            if (participationCount < 10) return grades.steady;
            return grades.enthusiast;
          };

          const usersWithGrades = computed(() => {
            return users.value.map((user) => ({
              ...user,
              grade: getUserGrade(user.participationCount),
            }));
          });

          const gradeCounts = computed(() => {
            const counts = { ì‹ ì…: 0, ê¾¸ì¤€: 0, ì—´í˜ˆ: 0, ë¯¸ì°¸ì—¬: 0 };
            usersWithGrades.value.forEach((user) => {
              counts[user.grade.name]++;
            });
            return counts;
          });

          // --- METHODS ---
          const handleFileUpload = (event) => {
            const file = event.target.files[0];
            if (!file) return;

            fileName.value = file.name;
            // NOTE: ì‹¤ì œ PDF íŒŒì‹± ëŒ€ì‹  ëª¨ì˜ ë°ì´í„°ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.
            loadMockData();
          };

          const loadMockData = () => {
            users.value = [
              {
                name: "ê¹€ì—´ì •",
                participationCount: 15,
                lastAccessDate: "2024.10.25",
                lastParticipationDate: "2024.10.25",
                introduction:
                  "ëª¨ì„ì˜ ëª¨ë“  í™œë™ì— ì°¸ì—¬í•˜ëŠ” ê²ƒì„ ì¢‹ì•„í•©ë‹ˆë‹¤. ë‹¤ìŒ ì •ëª¨ê°€ ê¸°ëŒ€ë˜ë„¤ìš”!",
              },
              {
                name: "ì´ê¾¸ì¤€",
                participationCount: 8,
                lastAccessDate: "2024.10.26",
                lastParticipationDate: "2024.10.20",
                introduction: "ê¾¸ì¤€íˆ ì°¸ì—¬í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.",
              },
              {
                name: "ë°•ì‹ ì…",
                participationCount: 2,
                lastAccessDate: "2024.10.26",
                lastParticipationDate: "2024.10.26",
                introduction:
                  "ì•ˆë…•í•˜ì„¸ìš”, ì´ë²ˆì— ìƒˆë¡œ ê°€ì…í–ˆìŠµë‹ˆë‹¤. ì˜ ë¶€íƒë“œë¦½ë‹ˆë‹¤.",
              },
              {
                name: "ìµœì´ˆë³´",
                participationCount: 1,
                lastAccessDate: "2024.10.24",
                lastParticipationDate: "2024.10.24",
                introduction:
                  "ì•„ì§ì€ ëª¨ë“  ê²ƒì´ ë‚¯ì„¤ì§€ë§Œ ì—´ì‹¬íˆ ë°°ì›Œë³´ê² ìŠµë‹ˆë‹¤.",
              },
              {
                name: "ì •ë‹¨ê³¨",
                participationCount: 7,
                lastAccessDate: "2024.10.21",
                lastParticipationDate: "2024.10.18",
                introduction: "ì´ ëª¨ì„, ì •ë§ ë§ˆìŒì— ë“¤ì–´ìš”.",
              },
              {
                name: "ê°•ë§¤ë‹ˆì•„",
                participationCount: 22,
                lastAccessDate: "2024.10.26",
                lastParticipationDate: "2024.10.25",
                introduction: "ìš´ì˜ì§„ ë²„ê¸ˆê°€ëŠ” ì—´ì •ìœ¼ë¡œ í•¨ê»˜í•©ë‹ˆë‹¤.",
              },
              {
                name: "ì¡°ìœ ë ¹",
                participationCount: 0,
                lastAccessDate: "2024.08.10",
                lastParticipationDate: "N/A",
                introduction: "ê°€ì…ë§Œ í•˜ê³  í™œë™ì„ ëª»í–ˆë„¤ìš”.",
              },
              {
                name: "ìœ¤ìƒˆë‚´ê¸°",
                participationCount: 3,
                lastAccessDate: "2024.10.22",
                lastParticipationDate: "2024.10.22",
                introduction: "ë§Œë‚˜ì„œ ë°˜ê°‘ìŠµë‹ˆë‹¤.",
              },
            ];
            selectedUser.value = null; // ë°ì´í„° ë¦¬ë¡œë“œ ì‹œ ì„ íƒ ì´ˆê¸°í™”
          };

          const selectUser = (user) => {
            selectedUser.value = user;
          };

          const renderChart = () => {
            if (chartInstance) {
              chartInstance.destroy();
            }
            const ctx = document.getElementById("gradeChart").getContext("2d");
            chartInstance = new Chart(ctx, {
              type: "bar",
              data: {
                labels: Object.keys(gradeCounts.value),
                datasets: [
                  {
                    label: "ë“±ê¸‰ë³„ ì¸ì›",
                    data: Object.values(gradeCounts.value),
                    backgroundColor: [
                      "rgba(255, 206, 86, 0.7)",
                      "rgba(54, 162, 235, 0.7)",
                      "rgba(255, 99, 132, 0.7)",
                      "rgba(153, 102, 255, 0.7)",
                    ],
                    borderColor: [
                      "rgba(255, 206, 86, 1)",
                      "rgba(54, 162, 235, 1)",
                      "rgba(255, 99, 132, 1)",
                      "rgba(153, 102, 255, 1)",
                    ],
                    borderWidth: 1,
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                  y: {
                    beginAtZero: true,
                    ticks: {
                      stepSize: 1,
                    },
                  },
                },
                plugins: {
                  legend: {
                    display: false,
                  },
                },
              },
            });
          };

          const exportToExcel = () => {
            const dataToExport = usersWithGrades.value.map((user) => ({
              ì´ë¦„: user.name,
              ë“±ê¸‰: `${user.grade.icon} ${user.grade.name}`,
              "ì°¸ì—¬ íšŸìˆ˜": user.participationCount,
              "ìµœì¢… ì ‘ì†ì¼": user.lastAccessDate,
              "ìµœì¢… ì°¸ì—¬ì¼": user.lastParticipationDate,
              ìê¸°ì†Œê°œ: user.introduction,
            }));
            const worksheet = XLSX.utils.json_to_sheet(dataToExport);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "ì‚¬ìš©ì ë°ì´í„°");
            XLSX.writeFile(workbook, "ì‚¬ìš©ì_ë¶„ì„_ë¦¬í¬íŠ¸.xlsx");
          };

          // --- WATCHERS ---
          watch(
            users,
            (newUsers) => {
              if (newUsers.length > 0) {
                nextTick(() => {
                  renderChart();
                });
              }
            },
            { deep: true }
          );

          return {
            users,
            fileName,
            selectedUser,
            usersWithGrades,
            handleFileUpload,
            selectUser,
            exportToExcel,
          };
        },
      }).mount("#app");
    </script>
  </body>
</html>
